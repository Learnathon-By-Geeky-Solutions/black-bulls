import{o as T,u as q,r as j,w as G,b as N,x as O,j as s,P as e,B as P,v as U,y as A}from"./index-BYmQdkFJ.js";const R=()=>{const r=T(),{t}=q("profile"),[u,a]=j.useState(!0),[f,i]=j.useState(null),h=G(o=>o.user.user);return j.useEffect(()=>{(async()=>{var g,m;try{a(!0),i(null);const n=await N.get("/profile");if(n.data.is_success)r(O(n.data.data));else throw new Error(n.data.message)}catch(n){i(((m=(g=n.response)==null?void 0:g.data)==null?void 0:m.message)||n.message||t("profile.fetchError"))}finally{a(!1)}})()},[r,t]),{user:h,updateProfile:async o=>{var g,m;try{a(!0),i(null);const n=new FormData;n.append("_method","PUT"),n.append("name",o.name||""),n.append("phone",o.phone||""),n.append("designation",o.designation||""),n.append("institution",o.institution||""),n.append("dept",o.dept||""),n.append("address",o.address||""),o.profile_picture&&n.append("profile_picture",o.profile_picture);for(let c of n.entries())console.log(c[0]+": "+c[1]);const l=await N.post("/profile",n,{headers:{"Content-Type":"multipart/form-data"}});if(console.log("Profile update response:",l.data),l.data.is_success)return r(O(l.data.data)),{success:!0,message:t("profile.updateSuccess")};throw new Error(l.data.message)}catch(n){console.error("Profile update error:",n);const l=((m=(g=n.response)==null?void 0:g.data)==null?void 0:m.message)||n.message||t("profile.updateError");return i(l),{success:!1,message:l}}finally{a(!1)}},updatePassword:async o=>{var g,m,n,l;try{a(!0),i(null);const c=await N.put("/profile/password",o,{headers:{"Content-Type":"application/json"}});return c.data.is_success?{success:!0,message:t("profile.passwordUpdateSuccess")}:{success:!1,message:c.data.message}}catch(c){return console.error("Password update error:",c),(m=(g=c.response)==null?void 0:g.data)!=null&&m.errors?{success:!1,errors:c.response.data.errors}:{success:!1,message:((l=(n=c.response)==null?void 0:n.data)==null?void 0:l.message)||c.message||t("profile.passwordUpdateError")}}finally{a(!1)}},isLoading:u,error:f}},M="_modalOverlay_1g78g_1",F="_modalContent_1g78g_14",L="_modalActions_1g78g_29",k="_cancelButton_1g78g_36",H="_saveButton_1g78g_50",C={modalOverlay:M,modalContent:F,modalActions:L,cancelButton:k,saveButton:H},S=({title:r,children:t,onClose:u,onSubmit:a,isLoading:f,submitText:i="Save",cancelText:h="Cancel",showActions:_=!0})=>s.jsx("div",{className:C.modalOverlay,children:s.jsxs("div",{className:C.modalContent,children:[s.jsx("h2",{children:r}),s.jsxs("form",{onSubmit:a,children:[t,_&&s.jsxs("div",{className:C.modalActions,children:[s.jsx("button",{type:"button",onClick:u,className:C.cancelButton,disabled:f,children:h}),s.jsx("button",{type:"submit",className:C.saveButton,disabled:f,children:f?"Saving...":i})]})]})]})});S.propTypes={title:e.string.isRequired,children:e.node.isRequired,onClose:e.func.isRequired,onSubmit:e.func.isRequired,isLoading:e.bool,submitText:e.string,cancelText:e.string,showActions:e.bool};const z="_formGroup_d229w_1",D="_input_d229w_14",J="_textarea_d229w_15",K="_error_d229w_32",Q="_fileInput_d229w_81",V="_previewContainer_d229w_88",W="_previewImage_d229w_92",X="_errorMessage_d229w_180",w={formGroup:z,input:D,textarea:J,error:K,fileInput:Q,previewContainer:V,previewImage:W,errorMessage:X},b=({label:r,name:t,type:u="text",value:a,onChange:f,error:i,placeholder:h,required:_=!1,disabled:x=!1,className:o="",...g})=>s.jsxs("div",{className:`${w.formGroup} ${o}`,children:[r&&s.jsx("label",{htmlFor:t,children:r}),s.jsx("input",{id:t,name:t,type:u,value:a,onChange:f,placeholder:h,required:_,disabled:x,className:`${w.input} ${i?w.error:""}`,...g}),i&&s.jsx("span",{className:w.errorMessage,children:Array.isArray(i)?i[0]:i})]});b.propTypes={label:e.string,name:e.string.isRequired,type:e.oneOf(["text","password","email","number","tel","url","search","date","time","datetime-local","month","week","color"]),value:e.oneOfType([e.string,e.number]),onChange:e.func.isRequired,error:e.oneOfType([e.string,e.arrayOf(e.string)]),placeholder:e.string,required:e.bool,disabled:e.bool,className:e.string};const E=({label:r,name:t,value:u,onChange:a,error:f,placeholder:i,required:h=!1,disabled:_=!1,rows:x=4,className:o="",...g})=>s.jsxs("div",{className:`${w.formGroup} ${o}`,children:[r&&s.jsx("label",{htmlFor:t,children:r}),s.jsx("textarea",{id:t,name:t,value:u,onChange:a,placeholder:i,required:h,disabled:_,rows:x,className:`${w.textarea} ${f?w.error:""}`,...g}),f&&s.jsx("span",{className:w.errorMessage,children:f})]});E.propTypes={label:e.string,name:e.string.isRequired,value:e.string,onChange:e.func.isRequired,error:e.oneOfType([e.string,e.arrayOf(e.string)]),placeholder:e.string,required:e.bool,disabled:e.bool,rows:e.number,className:e.string};e.string,e.string.isRequired,e.oneOfType([e.string,e.number]),e.func.isRequired,e.arrayOf(e.shape({value:e.oneOfType([e.string,e.number]).isRequired,label:e.string.isRequired})).isRequired,e.oneOfType([e.string,e.arrayOf(e.string)]),e.string,e.bool,e.bool,e.string;e.string.isRequired,e.string.isRequired,e.bool,e.func.isRequired,e.oneOfType([e.string,e.arrayOf(e.string)]),e.bool,e.bool,e.string;e.string.isRequired,e.string.isRequired,e.oneOfType([e.string,e.number]).isRequired,e.bool,e.func.isRequired,e.oneOfType([e.string,e.arrayOf(e.string)]),e.bool,e.bool,e.string;const B=({label:r,name:t,onChange:u,error:a,accept:f,required:i=!1,disabled:h=!1,className:_="",previewUrl:x,...o})=>s.jsxs("div",{className:`${w.formGroup} ${_}`,children:[r&&s.jsx("label",{htmlFor:t,children:r}),s.jsx("input",{type:"file",id:t,name:t,onChange:u,accept:f,required:i,disabled:h,className:`${w.fileInput} ${a?w.error:""}`,...o}),x&&s.jsx("div",{className:w.previewContainer,children:s.jsx("img",{src:x,alt:"Preview",className:w.previewImage})}),a&&s.jsx("span",{className:w.errorMessage,children:a})]});B.propTypes={label:e.string,name:e.string.isRequired,onChange:e.func.isRequired,error:e.oneOfType([e.string,e.arrayOf(e.string)]),accept:e.string,required:e.bool,disabled:e.bool,className:e.string,previewUrl:e.string};e.oneOf(["button","submit","reset"]),e.func,e.node.isRequired,e.oneOf(["primary","secondary","danger","success","warning"]),e.oneOf(["small","medium","large"]),e.bool,e.bool,e.string;const I=({user:r,onClose:t})=>{const{t:u}=q("profile"),{updateProfile:a,isLoading:f}=R(),[i,h]=j.useState({name:"",phone:"",profile_picture:null,designation:"",institution:"",dept:"",address:""}),[_,x]=j.useState(null),[o,g]=j.useState({});j.useEffect(()=>{var c,p,v,y;r&&(h({name:r.name||"",phone:r.phone||"",profile_picture:null,designation:((c=r.user_details)==null?void 0:c.designation)||"",institution:((p=r.user_details)==null?void 0:p.institution)||"",dept:((v=r.user_details)==null?void 0:v.dept)||"",address:((y=r.user_details)==null?void 0:y.address)||""}),x(r.profile_picture||null))},[r]);const m=c=>{const{name:p,value:v}=c.target;h(y=>({...y,[p]:v})),o[p]&&g(y=>({...y,[p]:null}))},n=c=>{const p=c.target.files[0];p&&(h(v=>({...v,profile_picture:p})),x(URL.createObjectURL(p)))},l=async c=>{c.preventDefault(),g({});const p=await a(i);p.success?(P.success(p.message),t()):p.errors?g(p.errors):P.error(p.message||u("profile.updateError"))};return s.jsxs(S,{title:u("profile.editProfile"),onClose:t,onSubmit:l,isLoading:f,children:[s.jsx(b,{label:u("profile.name"),name:"name",value:i.name,onChange:m,error:o.name,required:!0}),s.jsx(b,{label:u("profile.phone"),name:"phone",value:i.phone,onChange:m,error:o.phone,required:!0}),s.jsx(B,{label:u("profile.profilePicture"),name:"profile_picture",onChange:n,error:o.profile_picture,accept:"image/*",previewUrl:_}),s.jsx(b,{label:u("profile.designation"),name:"designation",value:i.designation,onChange:m,error:o.designation}),s.jsx(b,{label:u("profile.institution"),name:"institution",value:i.institution,onChange:m,error:o.institution}),s.jsx(b,{label:u("profile.department"),name:"dept",value:i.dept,onChange:m,error:o.dept}),s.jsx(E,{label:u("profile.address"),name:"address",value:i.address,onChange:m,error:o.address,rows:4})]})};I.propTypes={user:e.shape({name:e.string,phone:e.string,profile_picture:e.string,user_details:e.shape({designation:e.string,institution:e.string,dept:e.string,address:e.string})}),onClose:e.func.isRequired};const Y="_formError_131v7_27",Z={formError:Y},$=({onClose:r})=>{const{t}=q("profile"),{updatePassword:u,isLoading:a}=R(),[f,i]=j.useState({current_password:"",new_password:"",new_password_confirmation:""}),[h,_]=j.useState({}),[x,o]=j.useState(""),g=n=>{const{name:l,value:c}=n.target;i(p=>({...p,[l]:c})),h[l]&&_(p=>({...p,[l]:null})),x&&o("")},m=async n=>{n.preventDefault(),_({}),o("");const l=await u(f);console.log("Password update result:",l),l.success?(P.success(l.message),r()):l.errors?(console.log("Setting validation errors:",l.errors),_(l.errors)):l.message&&(console.log("Setting form error:",l.message),o(l.message))};return s.jsxs(S,{title:t("profile.changePassword"),onClose:r,onSubmit:m,isLoading:a,children:[x&&s.jsx("div",{className:Z.formError,children:x}),s.jsx(b,{label:t("profile.currentPassword"),name:"current_password",type:"password",value:f.current_password,onChange:g,error:h.current_password,required:!0}),s.jsx(b,{label:t("profile.newPassword"),name:"new_password",type:"password",value:f.new_password,onChange:g,error:h.new_password,required:!0}),s.jsx(b,{label:t("profile.confirmPassword"),name:"new_password_confirmation",type:"password",value:f.new_password_confirmation,onChange:g,error:h.new_password_confirmation,required:!0})]})};$.propTypes={onClose:e.func.isRequired};const ee="_profileContainer_1q39d_1",se="_profileCard_1q39d_10",re="_profileHeader_1q39d_19",ae="_avatar_1q39d_24",oe="_avatarImage_1q39d_36",ne="_avatarLetter_1q39d_42",te="_role_1q39d_54",ie="_profileInfo_1q39d_60",le="_infoGroup_1q39d_67",de="_profileActions_1q39d_84",ce="_editButton_1q39d_91",pe="_changePasswordButton_1q39d_92",ue="_logoutButton_1q39d_93",fe="_loading_1q39d_132",ge="_spinner_1q39d_142",me="_error_1q39d_156",d={profileContainer:ee,profileCard:se,profileHeader:re,avatar:ae,avatarImage:oe,avatarLetter:ne,role:te,profileInfo:ie,infoGroup:le,profileActions:de,editButton:ce,changePasswordButton:pe,logoutButton:ue,loading:fe,spinner:ge,error:me},_e=()=>{const{t:r}=q("profile"),t=U(),u=T(),{user:a,isLoading:f,error:i,updateProfile:h,updatePassword:_}=R(),[x,o]=j.useState(!1),[g,m]=j.useState(!1),n=()=>{localStorage.removeItem("token"),u(A()),t("/")},l=async p=>{try{(await h(p)).success&&o(!1)}catch(v){console.error("Failed to update profile:",v)}},c=async p=>{try{(await _(p)).success&&m(!1)}catch(v){console.error("Failed to update password:",v)}};return f?s.jsx("div",{className:d.profileContainer,children:s.jsxs("div",{className:d.loading,children:[s.jsx("div",{className:d.spinner}),s.jsx("p",{children:r("profile.loading")})]})}):i?s.jsx("div",{className:d.profileContainer,children:s.jsxs("div",{className:d.error,children:[s.jsx("p",{children:i}),s.jsx("button",{onClick:()=>window.location.reload(),children:r("profile.retry")})]})}):a?s.jsxs("div",{className:d.profileContainer,children:[s.jsxs("div",{className:d.profileCard,children:[s.jsxs("div",{className:d.profileHeader,children:[s.jsx("div",{className:d.avatar,children:a.profile_picture?s.jsx("img",{src:a.profile_picture,alt:a.name,className:d.avatarImage}):s.jsx("span",{className:d.avatarLetter,children:a.name.charAt(0).toUpperCase()})}),s.jsx("h1",{children:a.name}),s.jsx("p",{className:d.role,children:a.role})]}),s.jsxs("div",{className:d.profileInfo,children:[s.jsxs("div",{className:d.infoGroup,children:[s.jsx("label",{children:r("profile.email")}),s.jsx("p",{children:a.email})]}),s.jsxs("div",{className:d.infoGroup,children:[s.jsx("label",{children:r("profile.phone")}),s.jsx("p",{children:a.phone||"-"})]}),a.user_details&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:d.infoGroup,children:[s.jsx("label",{children:r("profile.designation")}),s.jsx("p",{children:a.user_details.designation||"-"})]}),s.jsxs("div",{className:d.infoGroup,children:[s.jsx("label",{children:r("profile.institution")}),s.jsx("p",{children:a.user_details.institution||"-"})]}),s.jsxs("div",{className:d.infoGroup,children:[s.jsx("label",{children:r("profile.department")}),s.jsx("p",{children:a.user_details.dept||"-"})]}),s.jsxs("div",{className:d.infoGroup,children:[s.jsx("label",{children:r("profile.address")}),s.jsx("p",{children:a.user_details.address||"-"})]})]})]}),s.jsxs("div",{className:d.profileActions,children:[s.jsx("button",{className:d.editButton,onClick:()=>o(!0),children:r("profile.editProfile")}),s.jsx("button",{className:d.changePasswordButton,onClick:()=>m(!0),children:r("profile.changePassword")}),s.jsx("button",{className:d.logoutButton,onClick:n,children:r("profile.logout")})]})]}),x&&s.jsx(I,{user:a,onClose:()=>o(!1),onSave:l}),g&&s.jsx($,{onClose:()=>m(!1),onSave:c})]}):s.jsx("div",{className:d.profileContainer,children:s.jsxs("div",{className:d.error,children:[s.jsx("p",{children:r("profile.noUser")}),s.jsx("button",{onClick:()=>t("/login"),children:r("profile.login")})]})})};export{_e as default};
