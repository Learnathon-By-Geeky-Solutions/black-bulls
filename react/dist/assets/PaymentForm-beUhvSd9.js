import{r as p,v as g,b as x,w as j,j as e}from"./index-CHC48D0u.js";const v=()=>{const[r,l]=p.useState(!1),[h,m]=p.useState(null),o=g();return{loading:r,error:h,initiatePayment:async i=>{var a,s,n,_,b;try{l(!0),m(null);const c=await x.post("/payments/initiate",i);return console.log("Payment API Response:",c.data),(a=c.data)!=null&&a.is_success?window.location.href=c.data.data.GatewayPageURL:c.data.is_success&&((s=c.data.data)!=null&&s.redirect_url)?window.location.href=c.data.data.redirect_url:m(((n=c.data)==null?void 0:n.message)||"Unexpected error occurred during payment initiation."),c.data}catch(c){console.error("Payment API Error:",c),m(((b=(_=c.response)==null?void 0:_.data)==null?void 0:b.message)||"Payment initiation failed. Please try again later.")}finally{l(!1)}},handlePaymentSuccess:async i=>{var a,s;try{l(!0);const n=await x.success(i);n.data.is_success?o("/payment/success"):m(n.data.message)}catch(n){m(((s=(a=n.response)==null?void 0:a.data)==null?void 0:s.message)||"Payment success handling failed")}finally{l(!1)}},handlePaymentFailure:async i=>{var a,s;try{l(!0),(await x.fail(i)).data.is_success||o("/payment/failed")}catch(n){m(((s=(a=n.response)==null?void 0:a.data)==null?void 0:s.message)||"Payment failure handling failed")}finally{l(!1)}},handlePaymentCancel:async i=>{var a,s;try{l(!0),(await x.cancel(i)).data.is_success||o("/payment/cancelled")}catch(n){m(((s=(a=n.response)==null?void 0:a.data)==null?void 0:s.message)||"Payment cancellation handling failed")}finally{l(!1)}}}},P="_paymentForm_ur6tl_1",G="_title_ur6tl_10",N="_form_ur6tl_16",w="_formGroup_ur6tl_22",F="_inputGroup_ur6tl_46",k="_inputPrefix_ur6tl_51",S="_checkboxGroup_ur6tl_65",C="_checkboxLabel_ur6tl_69",L="_error_ur6tl_81",q="_submitButton_ur6tl_90",t={paymentForm:P,title:G,form:N,formGroup:w,inputGroup:F,inputPrefix:k,checkboxGroup:S,checkboxLabel:C,error:L,submitButton:q},B=()=>{const r=j(d=>d.course.course),{loading:l,error:h,initiatePayment:m}=v(),[o,y]=p.useState({amount:(r==null?void 0:r.price)||0,customer_name:"",customer_mobile:"",customer_email:"",address:"",country:"Bangladesh",state:"",zip:""});p.useEffect(()=>{r&&y(d=>({...d,amount:r.price}))},[r]),p.useEffect(()=>{console.log("Redux course state:",r)},[r]);const u=d=>{const{name:i,value:a}=d.target;y(s=>({...s,[i]:a}))},f=async d=>{var s;d.preventDefault();const i={...o,course_id:r==null?void 0:r.id};console.log("Submitting payment with payload:",i);const a=await m(i);if(!a){console.error("No response received from payment API.");return}a!=null&&a.GatewayPageURL?window.location.href=a.GatewayPageURL:a!=null&&a.is_success&&((s=a==null?void 0:a.data)!=null&&s.redirect_url)?window.location.href=a.data.redirect_url:console.error("Failed to initiate payment:",a)};return e.jsxs("div",{className:t.paymentForm,children:[e.jsx("h4",{className:t.title,children:"Billing address"}),e.jsxs("form",{onSubmit:f,className:t.form,children:[e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{htmlFor:"customer_name",children:"Full name"}),e.jsx("input",{type:"text",name:"customer_name",id:"customer_name",value:o.customer_name,onChange:u,required:!0,placeholder:"John Doe"})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{htmlFor:"customer_mobile",children:"Mobile"}),e.jsxs("div",{className:t.inputGroup,children:[e.jsx("span",{className:t.inputPrefix,children:"+88"}),e.jsx("input",{type:"text",name:"customer_mobile",id:"customer_mobile",value:o.customer_mobile,onChange:u,required:!0,placeholder:"01711xxxxxx"})]})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{htmlFor:"customer_email",children:"Email"}),e.jsx("input",{type:"email",name:"customer_email",id:"customer_email",value:o.customer_email,onChange:u,required:!0,placeholder:"you@example.com"})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{htmlFor:"address",children:"Address"}),e.jsx("input",{type:"text",name:"address",id:"address",value:o.address,onChange:u,required:!0,placeholder:"1234 Main St"})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{htmlFor:"country",children:"Country"}),e.jsx("input",{type:"text",name:"country",id:"country",value:o.country,onChange:u,required:!0,readOnly:!0})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{htmlFor:"state",children:"State"}),e.jsx("input",{type:"text",name:"state",id:"state",value:o.state,onChange:u,required:!0,placeholder:"Dhaka"})]}),e.jsxs("div",{className:t.formGroup,children:[e.jsx("label",{htmlFor:"zip",children:"Zip"}),e.jsx("input",{type:"text",name:"zip",id:"zip",value:o.zip,onChange:u,required:!0,placeholder:"1200"})]}),e.jsxs("div",{className:t.checkboxGroup,children:[e.jsx("label",{htmlFor:"same_address",className:t.checkboxLabel,children:"Shipping address is the same as my billing address"}),e.jsx("input",{type:"checkbox",name:"same_address",id:"same_address"})]}),e.jsxs("div",{className:t.checkboxGroup,children:[e.jsx("label",{htmlFor:"save_info",className:t.checkboxLabel,children:"Save this information for next time"}),e.jsx("input",{type:"checkbox",name:"save_info",id:"save_info"})]}),h&&e.jsx("div",{className:t.error,children:h}),e.jsx("button",{type:"submit",className:t.submitButton,disabled:l,children:l?"Processing...":"Pay Now"})]})]})};export{B as default};
